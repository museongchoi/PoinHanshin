<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">
<head>
    <meta charset="UTF-8">
    <title>상세페이지</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.0.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
</head>
<style>


    button {
        float : right;
    }
    @media (min-width: 768px) {
      .page {
        width: 600px;
      }
    }

    @media (min-width: 992px) {
      .page {
        width: 940px;
      }
    }

    @media (min-width: 1200px) {
      .page {
        width: 940px;
      }
    }

.page {
        margin: 0 auto;
        height: 100%;
        padding: 50px;
        height: auto;
        min-height: 100%;
        border-left: 1px solid black;
        border-right: 1px solid black;
        border-bottom-width: 2px;
        padding-bottom: 20px
    }
  .commentbox {
        padding : 20px;
        border-top: 1px solid black;

    }
  .relpybox {
        padding : 20px;
         border-top: 1px solid black;
  }
   .commentbox2 {
        border-top: 1px solid black;
        padding : 30px;
  }
</style>
<body layout:fragment="content">
<div class="page">
<span class="fs-6">태그</span>

<!--    고양이=1(true), 강아지=0(false)-->
    <span th:if="${boardDto.board_ani_category == false}" class="badge rounded-pill text-bg-secondary">강아지</span>
    <span th:if="${boardDto.board_ani_category == true}"class="badge text-bg-primary">고양이</span>


    <!-- 제목 -->
    <div class="row">
        <div class="form-floating">
            <input type="text" readonly class="form-control-plaintext"
                   id="floatingEmptyPlaintextInput"
                   name="board_title"
                   th:value="${boardDto.board_title}"
                   >
            <label for="floatingEmptyPlaintextInput">제목</label>
        </div>
    </div>

    <!-- 이미지 파일 존재 여부에 따라 이미지 표시 -->
    <div th:if="${boardDto.fileAttached == 1}">
        <span th:each="fileName: ${boardDto.storedFileName}">
                <img th:src="@{|/upload/board/${fileName}|}" alt="이미지 없음" />
                <input type="hidden" name="storedFileName" th:value="${fileName}"/>
            </span>
    </div>
    <!-- 내용 -->
    <div class="row">
        <div class="col-mb-3">
            <!--  이미지     -->
            <div class="col-sm-6" >
                <img  class="img-fluid" alt="빈이미지" >
            </div>
            <textarea
                    type="text"
                    name="board_content"
                    class="form-control"
                    id="inputContent"
                    th:text="${boardDto.board_content}"
                    readonly="readonly"
                    style="height: 300px;border:none"
            ></textarea>
        </div>
    </div>

    <!-- 작성일 , 조회수 , 작성자 -->
    <div class="row">
        <span th:text="|작성일 : ${#dates.format(boardDto.board_reg_date, 'yyyy년 MM월 dd일 HH시 mm분 ss초')} |" >작성일:</span>
        <span th:text="|조회수 : ${boardDto.board_viewcount}|" >조회수:</span>
        <span th:text="|작성자 : ${boardDto.board_userno}|" >작성자:</span>
    </div>

<!--댓글출력-->
<!--${commentList} 댓글리스트-->

    <div id="commentTable">

            <div>
                <div class="commentbox" >
                    <input type="hidden" id="commentno" name="commentno" >
                    <div>
                        <small >유저id</small>
                        <small > 2010-11-11 10:51:03 (ex)</small>
                    </div>
                    <span >내용</span>
                    <span>
                        <button type="button" data-bs-toggle="collapse"


                                style="display:inline" class="btn btn-outline-primary btn-sm">답글달기
                        </button>
                    </span>
                    <span class="text-right" >
                        <span><button type="button" data-bs-toggle="collapse" class="btn btn-outline-primary btn-sm"
                                      style="display:inline" >수정</button>
                        </span>
                        <span><button type="submit"  class="btn btn-outline-danger btn-sm"  name="submit" value="delete">삭제</button></span>
                    </span>
                </div>

<!--        댓글수정          -->

                <div class="collapse" >
                    <form   method="post">
                        <div class="input-group" style="width:auto">
                            <label for="content" class="form-label mt-4" hidden>댓글 작성</label>
                            <input type="text"   class="form-control" >
                            <input type="hidden"  />
                            <input type="hidden" />
                            <button type="submit" class="btn btn-outline-dark">댓글작성</button>
                            <br>
                        </div>
                        <br>
                    </form>
                </div>


<!--        답글출력        -->
<!--parcommentno 답글을 구분-->

                <div  id="relybox">
                    <div class="relpybox" >
                        <i class="bi bi-arrow-90deg-up"></i>
                        <input type="hidden" id="replyno" name="relpyno" >
                        <div>
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="25" fill="currentColor" class="bi bi-arrow-90deg-up" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M4.854 1.146a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L4 2.707V12.5A2.5 2.5 0 0 0 6.5 15h8a.5.5 0 0 0 0-1h-8A1.5 1.5 0 0 1 5 12.5V2.707l3.146 3.147a.5.5 0 1 0 .708-.708l-4-4z"/>
                            </svg>
                            <small >유저id</small>
                            <small > 2010-11-11 10:51:03 (ex)</small>
                        </div>
                        <span >답글내용</span>
                        <span class="text-right" >
                                 <span><button type="button" data-bs-toggle="collapse" class="btn btn-outline-primary btn-sm"
                                              style="display:inline" >수정</button>
                                 </span>
                                <span><button type="button"  class="btn btn-outline-danger btn-sm">삭제</button></span>
                            </span>
                    </div>
                    <!--        답글수정          -->
                    <div class="collapse" >
                        <form   method="post">
                            <div class="input-group" style="width:auto">
                                <label for="content" class="form-label mt-4" hidden>댓글 작성</label>
                                <input type="text"   class="form-control">
                                <input type="hidden" />
                                <input type="hidden" />
                                <button type="submit" class="btn btn-outline-dark">댓글작성</button>
                                <br>
                            </div>
                            <br>
                        </form>
                    </div>
                </div>
                <div class="collapse" >
                    <form   method="post">
                        <div class="input-group" style="width:auto">
                            <label for="content" class="form-label mt-4" hidden>댓글 작성</label>
                            <input type="text"  class="form-control" >
                            <input type="hidden" />
                            <input type="hidden" />
                            <button type="submit" class="btn btn-outline-dark">답글작성</button>
                            <br>
                        </div>
                        <br>
                    </form>
                </div>
        </div>
        </th:block>
    </div>
<!--댓글작성-->
    <div class="commentbox2">
        <div>
            <p class="comment2" th:if="${session.isEmpty()}">로그인 후 댓글을 작성할 수 있습니다.</p>
        </div>


        <div>
            <form  method="post">
                <div class="input-group" style="width:auto">
                    <input type="hidden" name="boardcomment_userno" >
                    <label for="content" class="form-label mt-4" hidden>댓글 작성</label>
                    <input type="text"  class="form-control" id="content" name="content"
                           placeholder="1자에서 100자 이내로 입력해주세요.">
                    <div class="field-error" >
                        오류2
                    </div>
                    <button type="submit" class="btn btn-outline-dark">작성</button>
                    <br>
                </div>
            </form>
        </div>
    </div>

    <!-- 버튼 -->
    <button type="button" class="btn btn-secondary"
            th:onclick="|location.href='@{/board/list( page = ${sc.getPage} , pageSize = ${sc.getPageSize} , keyword=${sc.getKeyword} , ani_category = ${sc.getAni_category} )}'|">목록
    </button>
    <button type="button" class="btn btn-secondary"
            th:onclick="|location.href='@{/board/modify(boardno = ${boardDto.boardno} , page = ${sc.getPage} , pageSize = ${sc.getPageSize} , keyword=${sc.getKeyword} , ani_category = ${sc.getAni_category} )}'|">수정
    </button>
    <form id="removeForm" th:action="@{/board/remove(boardno = ${boardDto.boardno} , page = ${sc.getPage} , pageSize = ${sc.getPageSize} , keyword=${sc.getKeyword} , ani_category = ${sc.getAni_category} )}" method="post">
        <button type="button" id="removeBtn"class="btn btn-secondary">삭제</button>
    </form>

<script th:inline="javascript">

    // 삭제 버튼 클릭시
    $('#removeBtn').on("click",function(){
        if(!confirm("삭제하시겠습니까 ?")) return;
        console.log("게시물 삭제");

        let form = $('#removeForm');
        form.submit();
    });




    /*<![CDATA[*/


//테스트용 콘솔창데이터확인용
const list = [[${boardDto}]];
console.log(list);

//댓글삭제
function commentRemove(commentno) {

                if ( !confirm('댓글을 삭제할까요?') ) {
                    return false;
                }

                const formHtml = `
                    <form id="deleteForm" action="/comments/remove/(cno=commentno)" method="post">
                        <input type="hidden" id="commentno" name="commentno" value="commentno" />
                    </form>
                `;
                const doc = new DOMParser().parseFromString(formHtml, 'text/html');
                const form = doc.body.firstChild;
                document.body.append(form);
                document.getElementById('deleteForm').submit();
            }

//게시글삭제
 function removePost() {
                const id = /*[[ ${boardDto.boardno} ]]*/;

                if ( !confirm(id + '번 게시글을 삭제할까요?') ) {
                    return false;
                }

                const formHtml = `
                    <form id="deleteForm" action="/board/remove" method="post">
                        <input type="hidden" id="boardno" name="boardno" value="${boardDto.boardno}" />
                    </form>
                `;
                const doc = new DOMParser().parseFromString(formHtml, 'text/html');
                const form = doc.body.firstChild;
                document.body.append(form);
                document.getElementById('deleteForm').submit();
            }


/*]]>*/
</script>
</div>
</body>
</html>